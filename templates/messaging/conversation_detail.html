{% extends 'base.html' %}

{% block title %}Messages - SkillBazar{% endblock %}

{% block extra_css %}
<style>
    .messages-container { min-height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 2rem 0; }
    .chat-box { background: #fff; border-radius: 16px; box-shadow: 0 8px 32px rgba(0,0,0,0.08); max-width: 700px; margin: 0 auto; display: flex; flex-direction: column; height: 70vh; }
    .chat-header { padding: 1rem 1.5rem; border-bottom: 1px solid #eee; display: flex; align-items: center; justify-content: space-between; background: var(--gradient); color: #fff; border-radius: 16px 16px 0 0; }
    .chat-messages { flex: 1; overflow-y: auto; padding: 1.5rem; display: flex; flex-direction: column; gap: 1rem; background: #f8f9fa; }
    .chat-message { max-width: 70%; padding: 1rem; border-radius: 12px; position: relative; word-break: break-word; }
    .chat-message.sent { background: var(--primary); color: #fff; align-self: flex-end; border-bottom-right-radius: 4px; }
    .chat-message.received { background: #fff; color: #333; align-self: flex-start; border-bottom-left-radius: 4px; border: 1px solid #eee; }
    .chat-message .sender { font-size: 0.85em; font-weight: 600; margin-bottom: 0.25em; opacity: 0.7; }
    .chat-message .time { font-size: 0.75em; opacity: 0.6; margin-top: 0.5em; }
    .chat-input { border-top: 1px solid #eee; padding: 1rem 1.5rem; background: #fff; border-radius: 0 0 16px 16px; }
    .chat-input form { display: flex; gap: 1rem; }
    .chat-input input[type=text] { flex: 1; border-radius: 20px; border: 1px solid #ddd; padding: 0.75rem 1.25rem; font-size: 1rem; }
    .chat-input button { border-radius: 20px; background: var(--gradient); color: #fff; border: none; padding: 0.75rem 1.5rem; font-weight: 600; transition: background 0.2s; }
    .chat-input button:hover { background: var(--secondary); }
    .back-btn { background: rgba(255,255,255,0.2); border: none; border-radius: 8px; padding: 0.5rem 1rem; color: #fff; text-decoration: none; transition: all 0.3s; }
    .back-btn:hover { background: rgba(255,255,255,0.3); color: #fff; text-decoration: none; }
</style>
{% endblock %}

{% block content %}
<div class="messages-container">
    <div class="container py-5 position-relative">
        <a href="#" class="back-btn" onclick="window.history.back(); return false;" style="position:absolute;top:20px;left:-30px;z-index:10;width:40px;height:40px;background:#1877f2;border:none;border-radius:50%;color:white;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 8px rgba(24,119,242,0.3);transition:all 0.2s;text-decoration:none;"><i class="fas fa-arrow-left" style="font-size:1rem;"></i></a>
        <div class="chat-box">
            <div class="chat-header">
                <div>
                    <strong>{{ other_user.get_full_name }}</strong> <span class="text-light small">@{{ other_user.username }}</span>
                </div>
                <a href="{% url 'messaging:conversation_list' %}" class="back-btn"><i class="fas fa-arrow-left me-2"></i>Back</a>
            </div>
            <div class="chat-messages">
                {% for message in messages %}
                    <div class="chat-message {% if message.sender == user %}sent{% else %}received{% endif %}">
                        <div class="sender">{% if message.sender == user %}You{% else %}{{ other_user.get_full_name }}{% endif %}</div>
                        <div>{{ message.content }}</div>
                        <div class="time">{{ message.created_at|date:"M d, g:i A" }}</div>
                    </div>
                {% empty %}
                    <div class="text-center text-muted">No messages yet. Start the conversation!</div>
                {% endfor %}
            </div>
            <div class="chat-input">
                <form method="post">
                    {% csrf_token %}
                    <input type="text" name="content" placeholder="Type your message..." required autocomplete="off">
                    <button type="submit"><i class="fas fa-paper-plane"></i> Send</button>
                </form>
            </div>
        </div>
    </div>
</div>
<script>
    // Auto-scroll to bottom
    document.addEventListener('DOMContentLoaded', function() {
        var chat = document.querySelector('.chat-messages');
        if (chat) chat.scrollTop = chat.scrollHeight;
    });
</script>
{% endblock %} 